{% load core_utils %}
{% include "bootstrap5/errors.html" %}
<form class="d-flex flex-column gap-2 small small-form" action="{% if form.instance.id %}{{ form.instance.get_edit_url }}{% elif category %}{{ category.get_add_quantity_url }}{% else %}{{ project.get_add_quantity_url }}{% endif %}?date={{ date_str }}&interval={{ interval }}{% if next %}&next={{ next }}{% endif %}{% if form.instance.id and not next_with_children %}&with-children=0{% endif %}" method="post">
    {% csrf_token %}
    {% if not form.instance.id %}
        {% if category %}
            <p class="mb-1">
                <span class="fw-bold">This will add a quantity directly in the «{{ category.name }}» category</span>
                <span class="small">(or pick a sub-category)</span>
            </p>
        {% else %}
            <p class="mb-1 fw-bold">This will add a quantity in the «{{ project.name }}» project in the chosen category.</p>
        {% endif %}
    {% endif %}
    <div class="input-group input-group-sm">
        {% include "field_include.html" with field=form.value no_errors=True wrapper_class="mb-0" %}
        {% if not form.instance.id %}<button class="btn btn-primary" type="submit">Add</button>{% endif %}
    </div>
    {% for field in form %}
        {% if field.name == 'datetime' %}
            <div class="input-group datepicker-container flatpickr" data-alt-input="true" data-enable-time="true" data-wrap="true" data-click-opens="false"{% if "data-min-date" in field.field.widget.attrs %} data-min-date="{{ field.field.widget.attrs|dict_value:"data-min-date" }}"{% endif %}{% if "data-max-date" in field.field.widget.attrs %} data-max-date="{{ field.field.widget.attrs|dict_value:"data-max-date" }}"{% endif %}>
                {{ field }}
                <button class="btn btn-sm btn-outline-secondary input-group-btn" type="button" data-toggle title="Open calendar">{% icon "calendar" %}</button>
                <button class="btn btn-sm btn-outline-secondary input-group-btn" type="button" data-clear title="Clear selected date">{% icon "xmark" %}</button>
            </div>
        {% elif field.name == 'category' %}
            {% include "bootstrap5/field.html" with field=form.category form_show_labels=True wrapper_class="mb-0" %}
        {% elif field.name != 'value' %}
            {% include "bootstrap5/field.html" with wrapper_class="mb-0" %}
        {% endif %}
    {% endfor %}
    <button class="btn btn-sm btn-primary" type="submit">{% if form.instance.id %}Update{% else %}Add{% endif %} quantity</button>
</form>
